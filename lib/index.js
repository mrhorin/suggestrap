!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("lodash"),require("superagent"));else if("function"==typeof define&&define.amd)define(["lodash","superagent"],t);else{var n="object"==typeof exports?t(require("lodash"),require("superagent")):t(e.lodash,e.superagent);for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(global,function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(t,n){t.exports=e},,,,function(e,n){e.exports=t},,function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),s=n(4),o=n.n(s);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.req=this._reqInitialize(t),this.option=this._optionInitialize(r),this.state=this._stateInitialize(),this.element=this._elementInitialize(),this._setEventListener(),this.hide(),this.keyUpHandler=i.a.debounce(function(e){n._isReadyToShow()?(n.state.query=e.target.value,n.hasUrl()?n._fetchJson(function(e){e.length>0&&(n._add(e),n.show())}):n.req.values.length>0&&(n._add(n.suggestions),n.show())):(n.state.query="",n.hide(),n._remove())},this.option.delay)}var t,n,r;return t=e,(n=[{key:"show",value:function(){var e=this.element.target.getBoundingClientRect(),t=this.element.target.offsetLeft,n=this.element.target.offsetTop+e.height;this.element.suggestrap.style.left=Math.round(t).toString()+"px",this.element.suggestrap.style.top=Math.round(n).toString()+"px",this.element.suggestrap.style.visibility="visible",this.state.isShow=!0}},{key:"hide",value:function(){this.state.isShow&&(this.element.suggestrap.style.visibility="hidden",this.state.isShow=!1)}},{key:"moveUpSuggest",value:function(){this.state.isShow&&(this.state.currentIndex>-1?this.state.currentIndex-=1:this.state.currentIndex=this.element.suggestrap.childNodes.length-1,this._activeCurrentSuggest())}},{key:"moveDownSuggest",value:function(){this.state.isShow&&(this.state.currentIndex==this.element.suggestrap.childNodes.length-1?this.state.currentIndex=-1:this.state.currentIndex+=1,this._activeCurrentSuggest())}},{key:"hasValues",value:function(){return"values"in this.req&&"object"==a(this.req.values)&&this.req.values.length>0}},{key:"hasUrl",value:function(){return"values"in this.req&&"string"==typeof this.req.values&&this._validateUrl(this.req.values)||"url"in this.req&&"string"==typeof this.req.url&&this._validateUrl(this.req.url)}},{key:"_isReadyToShow",value:function(){return document.activeElement.id==this.req.target&&this.element.target.value.length>=this.option.minlength&&this.element.target.value!=this.state.query}},{key:"_add",value:function(e){var t=this;this._remove();var n=0,r=!0,i=!1,s=void 0;try{for(var o,a=this._parseJson(e)[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u=o.value,l=document.createElement("li");if(l.style.textAlign="left",l.style.whiteSpace="nowrap",l.style.overflow="hidden",l.style.padding="1px 6px",l.innerHTML=u[this.req.key],l.addEventListener("click",function(e){t.element.target.value=e.target.innerHTML,t.hide()}),this.element.suggestrap.appendChild(l),(n+=1)>=this.option.count)break}}catch(e){i=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}this.state.currentIndex=-1}},{key:"_remove",value:function(){for(;this.element.suggestrap.firstChild;)this.element.suggestrap.removeChild(this.element.suggestrap.firstChild);this._stateInitialize()}},{key:"_activeCurrentSuggest",value:function(){for(var e=0;e<this.element.suggestrap.childNodes.length;e++)this.element.suggestrap.childNodes[e].className="";switch(this.state.currentIndex){case-1:break;default:this.element.suggestrap.childNodes[this.state.currentIndex].className="suggestrap-active",this.element.target.value=this.element.suggestrap.childNodes[this.state.currentIndex].innerHTML}}},{key:"_validateUrl",value:function(e){return RegExp(/^https?:\/\//,"i").test(e)}},{key:"_parseJson",value:function(e){if("string"==typeof e)return JSON.parse(e);if("object"==a(e))return e;throw new Error("It must be JSON or Object.")}},{key:"_fetchJson",value:function(e){var t=this;new Promise(function(e,n){o.a.get(t.jsonUrl).end(function(t,r){t?n(t):e(r)})}).then(function(t){e(t.text)}).catch(function(e){console.log(e)})}},{key:"_setEventListener",value:function(){var e=this;this.element.target.addEventListener("keyup",function(t){var n=t.keyCode;[38,40,37,39,16,17,27,13].includes(n)?38==n?e.moveUpSuggest():40==n?e.moveDownSuggest():27==n?e.hide():13==n&&(-1!=e.state.currentIndex?e.hide():e.keyUpHandler(t)):e.keyUpHandler(t)}),this.element.target.addEventListener("blur",function(t){i.a.delay(function(){e.hide()},200)}),this.element.target.addEventListener("focus",function(t){e.keyUpHandler(t)}),this.element.target.addEventListener("textInput",function(t){e.keyUpHandler(t)}),window.onresize=function(){e.hide()}}},{key:"_reqInitialize",value:function(e){if(!("target"in e))throw new Error("target is not found. This key is necessary.");if("string"!=typeof e.target)throw new Error("target must be a string.");if(!("key"in e))throw new Error("key is not found. This key is necessary.");if("string"!=typeof e.key)throw new Error("key must be a string.");if(!("values"in e||"url"in e))throw new Error("values and url are not found. Either key is necessary.");if("values"in e&&"string"!=typeof e.values&&"object"!=a(e.values))throw new Error("values must be a string or an array that has hashes.");if("values"in e&&"string"==typeof e.values&&!this._validateUrl(e.values))throw new Error(e.values+" is not URL even if it is string.");if("url"in e&&"string"!=typeof e.url)throw new Error("url must be a string.");if("url"in e&&"string"==typeof e.url&&!this._validateUrl(e.url))throw new Error(e.url+" is not URL even if it is string.");return e}},{key:"_optionInitialize",value:function(e){return"wildcard"in e||(e.wildcard="%QUERY"),"minlength"in e||(e.minlength=2),"delay"in e||(e.delay=400),"count"in e||(e.count=5),"id"in e||(e.id=""),e}},{key:"_stateInitialize",value:function(){return this.state={query:"",isShow:!1,currentIndex:-1}}},{key:"_elementInitialize",value:function(){var e,t={target:document.getElementById(this.req.target),suggestrap:document.createElement("ul"),style:document.createElement("style")};if(!t.target)throw new Error(t.target+" element is not found.");if(this.option.id)e=this.option.id;else if(document.getElementById("suggestrap")){for(var n=2;document.getElementById("suggestrap_"+n);)n++;e="suggestrap_"+n}else e="suggestrap";var r="\n    ul#".concat(e,"{\n      position: absolute;\n      z-index: 99999;\n      padding: 3px 0;\n      margin: 0;\n      width: auto;\n      height: auto;\n      list-style: none;\n      background: #fff;\n      border-radius: 3px;\n      box-shadow: -2px 2px 7px rgba(0,0,0,0.3);\n    }\n    ul#").concat(e," li{\n      color: #333;\n      text-align: left;\n      white-space: nowrap;\n      overflow: hidden;\n      padding: 1px 6px;\n    }\n    ul#").concat(e," li.suggestrap-active{\n      background: #0099ff;\n      color: #fff;\n    }\n    ul#").concat(e," li.suggestrap-active,\n    ul#").concat(e," li:hover{\n      cursor: pointer;\n      background: #4b89bf;\n      color: #fff;\n    }\n    ");return t.style.appendChild(document.createTextNode(r)),document.getElementsByTagName("head")[0].appendChild(t.style),t.target.autocomplete="off",t.suggestrap.id=e,t.target.parentNode.insertBefore(t.suggestrap,t.target.nextSibling),t}},{key:"jsonUrl",get:function(){return this.hasUrl()&&"values"in this.req?this.req.values.replace(this.option.wildcard,this.state.query):this.hasUrl()&&"url"in this.req?this.req.url.replace(this.option.wildcard,this.state.query):(console.warn("JSON URL isn't found because Suggestrap don't have an URL."),"")}},{key:"suggestions",get:function(){var e=[];if(this.req.values&&this.state.query)for(var t=new RegExp(this.state.query,"i"),n=0;n<this.req.values.length&&e.length<this.option.count;n++)this.req.values[n][this.req.key].match(t)&&e.push(this.req.values[n]);return e}}])&&u(t.prototype,n),r&&u(t,r),e}();n.d(t,"Suggestrap",function(){return l});t.default=l}])});